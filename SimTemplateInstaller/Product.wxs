<?xml version="1.0" encoding="UTF-8"?>
<?include config.wxi ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!--
   Upgrade code HAS to be the same for all updates. Once you've chosen it don't change it.
   Product IDs must be autogenerated (*) or else major upgrades will not work -->
  <Product Id="*" Name="$(var.ProductName)" Language="1033" Version="$(var.Version)" Manufacturer="$(var.Manufacturer)"
           UpgradeCode="$(var.UpgradeCode)">
    <Package Id="*" Keywords="Installer"
             InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <!-- Remove previously installed versions-->
    <Upgrade Id="$(var.UpgradeCode)">
      <UpgradeVersion Minimum="$(var.Version)" IncludeMinimum="no" Property="NEWERVERSIONDETECTED" />
    </Upgrade>
    <InstallExecuteSequence>
      <RemoveExistingProducts After="InstallInitialize" />
      <Custom Action="NewerVersion" After="FindRelatedProducts">NEWERVERSIONDETECTED</Custom>
    </InstallExecuteSequence>

    <CustomAction Id="NewerVersion" Error="A newer version of $(var.ProductName) is already installed." />
    <!--<MajorUpgrade DowngradeErrorMessage="A newer version of $(var.ProductName) is already installed." />-->
    <MediaTemplate EmbedCab="yes"/>
    
    <!-- The directory structure of the installed product -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="ManufacturerDir" Name="$(var.Manufacturer)">
          <Directory Id="ProductDir" Name="$(var.ProductName)" />
        </Directory>
      </Directory>
    </Directory>

    <!-- Tell WiX to install the files defined in the ProductCompenents fragment -->
    <Feature Id="ProductFeature" Title="SimTemplateInstaller" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
    
    <!-- Tell WiX to show the specified licence file while installing -->
    <Property Id="WIXUI_INSTALLDIR" Value="ProductDir" />
    <UIRef Id="WixUI_InstallDir" />
    <WixVariable Id="WixUILicenseRtf" Value="GPL_v3.rtf" />
  </Product>
</Wix>